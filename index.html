<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DefyBot AI | Debug Mode</title>
    <style>
        :root { --primary: #dc2626; /* RED FOR DEBUG MODE */ --bg: #f8fafc; --sidebar: #1e293b; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: monospace; }
        body { background: var(--bg); height: 100vh; display: flex; overflow: hidden; }

        .sidebar { width: 260px; background: var(--sidebar); color: white; padding: 25px; display: flex; flex-direction: column; }
        .main { flex: 1; display: flex; flex-direction: column; }
        
        #chatDisplay { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
        .msg { padding: 15px; border-radius: 8px; font-size: 14px; white-space: pre-wrap; word-break: break-word; }
        .ai { background: white; border: 1px solid #ccc; color: #333; }
        .user { background: #333; color: white; align-self: flex-end; }
        .error-log { background: #fee2e2; border: 1px solid #dc2626; color: #b91c1c; font-family: monospace; font-size: 12px; }

        .input-bar { display: flex; padding: 20px; background: white; border-top: 1px solid #ccc; }
        input { flex: 1; padding: 10px; border: 1px solid #ccc; border-radius: 4px; margin-right: 10px; }
        button { padding: 10px 20px; background: #333; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>

    <nav class="sidebar">
        <h2>⚠️ DEBUG MODE</h2>
        <p style="font-size: 12px; color: #ccc; margin-top: 10px;">This mode displays raw API errors to help fix the connection.</p>
    </nav>

    <main class="main">
        <div id="chatDisplay">
            <div class="msg ai">System Ready. Type "test" to run a diagnostic check on your API Key.</div>
        </div>
        <div class="input-bar">
            <input type="text" id="userInput" placeholder="Type 'test'..." onkeypress="if(event.key==='Enter') send()">
            <button onclick="send()">Run Test</button>
        </div>
    </main>

    <script>
        const API_KEY = "AIzaSyDAl7mknM1IidGe6MtIW1ibTgB7wXHFIIE";

        async function send() {
            const input = document.getElementById('userInput');
            const txt = input.value.trim();
            if(!txt) return;

            addMsg(txt, 'user');
            input.value = '';
            addMsg("Running diagnostics on all models...", 'ai');

            // 1. Try Flash
            await tryModel("gemini-1.5-flash", txt);
            
            // 2. Try Pro (Backup)
            await tryModel("gemini-pro", txt);
        }

        async function tryModel(modelName, prompt) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/${modelName}:generateContent?key=${API_KEY}`;
            
            addMsg(`Attempting connection to: ${modelName}...`, 'ai');

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: [{ role: "user", parts: [{ text: prompt }] }] })
                });

                const data = await response.json();

                if (data.error) {
                    // PRINT THE EXACT ERROR FROM GOOGLE
                    console.error(data);
                    addMsg(`❌ ${modelName} FAILED:\nCode: ${data.error.code}\nMessage: ${data.error.message}\nStatus: ${data.error.status}`, 'error-log');
                } else {
                    const ans = data.candidates[0].content.parts[0].text;
                    addMsg(`✅ ${modelName} SUCCESS!\nResponse: ${ans}`, 'ai');
                }

            } catch (e) {
                addMsg(`❌ NETWORK ERROR for ${modelName}: ${e.message}`, 'error-log');
            }
        }

        function addMsg(text, type) {
            const div = document.createElement('div');
            div.className = `msg ${type}`;
            div.innerText = text;
            document.getElementById('chatDisplay').appendChild(div);
            document.getElementById('chatDisplay').scrollTop = 99999;
        }
    </script>
</body>
</html>
