<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DefyBot AI | Gemini Powered</title>
    <style>
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --bg-light: #f9fafb;
            --border: #e5e7eb;
            --text-main: #1f2937;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', -apple-system, sans-serif; }

        /* Login Screen */
        #loginPage {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .login-card {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        /* App Layout */
        #appContainer { display: none; height: 100vh; background: var(--bg-light); }
        
        .sidebar {
            width: 260px;
            background: white;
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .main-content { flex: 1; display: flex; flex-direction: column; overflow: hidden; }

        /* Chat UI */
        .chat-area {
            flex: 1;
            max-width: 900px;
            margin: 0 auto;
            width: 100%;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .msg { max-width: 80%; padding: 12px 16px; border-radius: 15px; font-size: 15px; line-height: 1.5; }
        .ai-msg { background: white; align-self: flex-start; border: 1px solid var(--border); }
        .user-msg { background: var(--primary); color: white; align-self: flex-end; }

        /* Input Area */
        .input-box {
            background: white;
            padding: 20px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 10px;
        }

        input {
            flex: 1;
            padding: 12px 20px;
            border: 1px solid var(--border);
            border-radius: 30px;
            outline: none;
        }

        button.send-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
        }

        /* Utility Classes */
        .hidden { display: none !important; }
    </style>
</head>
<body>

    <div id="loginPage">
        <div class="login-card">
            <h2>ðŸ¤– DefyBot AI</h2>
            <p style="margin: 10px 0 25px; color: #666;">Enter Password to access</p>
            <input type="password" id="passInput" placeholder="Password..." style="margin-bottom: 15px; width: 100%;">
            <button class="send-btn" onclick="checkAuth()" style="width: 100%;">Unlock</button>
        </div>
    </div>

    <div id="appContainer" style="display: flex;">
        <aside class="sidebar">
            <h3>DefyBot AI</h3>
            <hr style="margin: 20px 0;">
            <p style="font-size: 12px; color: #888;">MODES</p>
            <button onclick="switchMode('chat')" style="margin-top: 10px; padding: 10px; text-align: left; cursor: pointer;">ðŸ’¬ Chat Mode</button>
            <button onclick="switchMode('tools')" style="margin-top: 5px; padding: 10px; text-align: left; cursor: pointer;">ðŸ“„ Writing Tools</button>
        </aside>

        <main class="main-content">
            <section id="chatSection" class="chat-area">
                <div class="messages-container" id="chatDisplay">
                    <div class="msg ai-msg">Welcome, Mujtaba. How can I assist with your training or projects today?</div>
                </div>
                <div class="input-box">
                    <input type="text" id="chatInput" placeholder="Message Gemini..." onkeypress="handleEnter(event)">
                    <button class="send-btn" onclick="sendToGemini()">Send</button>
                </div>
            </section>
        </main>
    </div>

    <script>
        // CONFIGURATION
        const WORKER_URL = "YOUR_CLOUDFLARE_WORKER_URL_HERE"; 
        let history = []; // Stores the session memory

        // AUTHENTICATION
        function checkAuth() {
            const pass = document.getElementById('passInput').value;
            if (pass.toLowerCase() === 'mujtaba') {
                document.getElementById('loginPage').classList.add('hidden');
                document.getElementById('appContainer').style.display = 'flex';
            } else {
                alert("Incorrect Password");
            }
        }

        // CHAT LOGIC
        async function sendToGemini() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            // Update UI
            appendMsg(message, 'user-msg');
            input.value = '';

            // Update History
            history.push({ role: "user", parts: [{ text: message }] });

            try {
                const response = await fetch(WORKER_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: history })
                });

                const data = await response.json();
                const aiResponse = data.reply;

                appendMsg(aiResponse, 'ai-msg');
                history.push({ role: "model", parts: [{ text: aiResponse }] });

            } catch (err) {
                appendMsg("System Error: Could not reach the Cloudflare Worker.", 'ai-msg');
            }
        }

        function appendMsg(text, type) {
            const container = document.getElementById('chatDisplay');
            const div = document.createElement('div');
            div.className = `msg ${type}`;
            div.innerText = text;
            container.appendChild(div);
            container.scrollTop = container.scrollHeight;
        }

        function handleEnter(e) { if (e.key === 'Enter') sendToGemini(); }
    </script>
</body>
</html>
